<!DOCTYPE html>
<html>



<head>
    <title>Welcome!</title>
</head>
<body>
<h1>ARWorld</h1>
<p id="demo"></p>

<form id="form1" method="get">
    Username:<br>
    <input type="text" name="username" value="Mickey">
    <br>
    Password:<br>
    <input type="text" name="password" value="Mouse">
    <br><br>
    <input type="button" onclick="loginUser()" value="Login">
    <input type="button" onclick="createUser()" value="New User">
</form>

<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCbUoec8Hr-DtnUk1srWlpRpGEZycTgBHI",
        authDomain: "arworldgt.firebaseapp.com",
        databaseURL: "https://arworldgt.firebaseio.com",
        projectId: "arworldgt",
        storageBucket: "",
        messagingSenderId: "1007753558225"
    };
    firebase.initializeApp(config);
    // Get a reference to the database service
    var database = firebase.database();
    let objects = firebase.database().ref('/objects/');
    function writeObjectData(number, latitude, longitude, altitude, username, pub, color) {
        firebase.database().ref('/objects/' + number).set({
            longitude: longitude,
            latitude: latitude,
            altitude: altitude,
            username: username,
            public: pub,
            color: color
        });
    }
    writeObjectData(0, 33.774577, -84.397340, 286, "womackj", false, 'white');
    writeObjectData(1, 33.775196, -84.397319, 286, "womackj", false, 'red');
    writeObjectData(2, 33.774017, -84.397363, 286, "womackj", false, 'blue');
    writeObjectData(3, 33.774618, -84.396867, 286, "womackj", false, 'yellow');
    writeObjectData(4, 33.774615, -84.397792, 286, "womackj", false, 'purple');

    let groups = firebase.database().ref('/groups/');
    function writeGroupData(name, members) {
        firebase.database().ref('/groups/' + name).set({
            members: members
        });
    }
</script>

<script>
    function createUser() {
        var x = document.getElementById("form1");
        let username = x.elements[0].value;
        let password = x.elements[1].value;
        let exists = false;
        let users = firebase.database().ref('/users/');
        users.once('value').then(function (snapshot) {
            snapshot.forEach(function (childSnapshot) {
                let usernameDB = childSnapshot.key;
                let temp = `${childSnapshot.key}/password`;
                let passwordDB = snapshot.child(temp).val();
                if (usernameDB === username) {
                    exists = true;
                } else {
                }
            });
        });
        if (!exists) {
            demo.innerHTML = "User Created";
            writeUserData(username, password);
        }
    }
    function loginUser() {
        var x = document.getElementById("form1");
        let username = x.elements[0].value;
        let password = x.elements[1].value;
        let users = firebase.database().ref('/users/');
        users.once('value').then(function(snapshot) {
            snapshot.forEach(function(childSnapshot) {
               let usernameDB = childSnapshot.key;
               let temp =`${childSnapshot.key}/password`;
               let passwordDB = snapshot.child(temp).val();
               if (usernameDB === username && passwordDB === password) {
                   localStorage.setItem("username", usernameDB);
                   localStorage.setItem("password", passwordDB);
                   location.assign('arworld.html');
               }
            });
        });
    }
    function writeUserData(username, password) {
        firebase.database().ref('users/' + username).set({
            password: password
        });
    }
    function writeUserData(username, password, groups) {
        firebase.database().ref('users/' + username).set({
            password: password,
            groups: groups
        });
    }
    function updateUserPosition(username, latitude, longitude, altitude, groups) {
        firebase.database().ref('users/' + username).set({
            latitude: latitude,
            longitude: longitude,
            altitude: altitude,
            groups: groups
        });
    }
</script>

</body>
</html>