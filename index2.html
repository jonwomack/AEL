<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
    <style>
        a-scene {
            position: relative;
            left: 33%;
            width: 600px;
            height: 400px;
        }
        #a-scene {
            margin-left: 10 auto;
            margin-right: 10 auto;
            display: block;
        }
        p {
            position: relative;
            text-align: center;
            color: white;
        }
        button {
            position: relative;
            left: 50%;
        }
        body {
            background-color: #00BFFF;
        }
    </style>
</head>
<body>
<p>First, store your lat/lon by pressing this button.</p>
<button onclick="getLocation()">Store</button>
<p>Then, place objects by pressing this button</p>
<button onclick="placeObjects()">Place</button>


<div id="a-scene">
    <a-scene embedded>
        <a-sky color="#6EBAA7"></a-sky>
        <a-text value="Hello, World!" col></a-text>

    </a-scene>
</div>

<p>To see current position click here</p>
<button onclick="makeString()">Here</button>
<p>List Objects</p>
<button onclick="ARtoString()">List</button>
<p id="demo"></p>
<script>
    const waffleHouse = new AR(33.776569,-84.389431, "Waffle House");
    const starBucks = new AR(33.776596, -84.388353, "Starbucks");
    const ncr = new AR(33.778950, -84.389375, "NCR Global");
    const westVillage = new AR(33.779372, -84.404727, "West Village");
    const wingZone = new AR(33.779439, -84.405424, "Wing Zone");
    const fitten = new AR(33.778210, -84.403753, "Fitten");
    const folk = new AR(33.778907, -84.404858, "Folk");
    const objs = [waffleHouse, starBucks, ncr, westVillage, wingZone, fitten, folk];
    const demo = document.getElementById("demo");
    var currLat;
    var currLon;
    var currAlt;
    var currHeading;


    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(storePosition);
        } else {
            demo.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function storePosition(position) {
        currLat = position.coords.latitude;
        currLon = position.coords.longitude;
        currAlt = position.coords.altitude;
        currHeading = position.coords.heading;
    }

    function placeObjects() {
        objs.forEach(function (item, index, array) {
            createObject(item);
        });
    }


    function createObject(obj) {
        let distance = calculateDistance(currLat, obj.lat, currLon, obj.lon);
        let bearing = calculateBearing(currLat, obj.lat, currLon, obj.lon);
        let x = distance * Math.cos(bearing);
        let y = distance * Math.sin(bearing);
        let z = 10;
        let el = document.createElement('a-entity');
        el.setAttribute('geometry', {
            primitive: 'sphere',
            radius: 15
        });
        el.setAttribute('position', {
            x: x,
            y: y,
            z: z
        });
        el.setAttribute('color', obj.color);
        let sceneEl = document.querySelector('a-scene');
        sceneEl.appendChild(el);
    }

    function makeString() {
        demo.innerHTML = "Latitude: " + currLat +
            "<br>Longitude: " + currLon +
            "<br>Altitude: " + currAlt +
            "<br>Heading: " + currHeading + "<br><br>";
    }

    function calculateDistance(lat1, lat2, lon1, lon2) {
        const radius = 6371e3; // Radius of Earth in Meters
        let lat1radians = toRadians(lat1);
        let lat2radians = toRadians(lat2);
        let deltaLat = toRadians(lat2-lat1);
        let deltaLon = toRadians(lon2-lon1);
        let a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) + Math.cos(lat1radians) * Math.cos(lat2radians) * Math.sin(deltaLon/2) * Math.sin(deltaLon/2);
        let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        let distance = radius * c;
        demo.innerHTML += "<br>Name: " + distance;
        return distance;
    }

    function calculateBearing(latB1, latB2, lonB1, lonB2) {
        let dLon = (lonB2-lonB1);
        let y = Math.sin(dLon) * Math.cos(latB2);
        let x = Math.cos(latB1)*Math.sin(latB2) - Math.sin(latB1)*Math.cos(latB2)*Math.cos(dLon);
        let brng = toDegrees((Math.atan2(y, x)));
        brng = (360 - ((brng + 360) % 360));
        return brng;
    }

    function toDegrees(radians) {
        return radians * (180/Math.PI);
    }
    function toRadians(degrees) {
        return degrees * (Math.PI/180);
    }
    function AR(lat, lon) {
        AR(lat, lon, "");
    }
    function AR(lat, lon, name) {
        AR(lat, lon, name, 'FFF');
    }

    function AR(lat, lon, name, color) {
        this.lat = lat;
        this.lon = lon;
        this.name = name;
        this.color = color;
    }

    function ARtoString() {
        objs.forEach(function (item, index, array) {
            demo.innerHTML += "<br>Name: " + item.name +
                "<br>Latitude: " + item.lat +
                "<br>Longitude: " + item.lon + "<br><br>";
        })
    }
</script>






</body>
</html>